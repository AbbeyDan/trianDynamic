<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>线上缴费</title>
    <link rel="stylesheet" href="../../plugin/seedsui.min.css">
    <link rel="stylesheet" href="../../css/square/red.css">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/person-info.css">
    <link rel="stylesheet" href="../../css/uiAlertView-1.0.0.css">
    <script src="../../js/rem.js"></script>

</head>

<body>
    <div class="pay_mod">
        <h4>参会须知</h4>
        <div class="pm_text">
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯丝阿萨德了飞机撒打开阿斯斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
            <p>的斯科拉粉丝阿萨德了飞机撒打开阿斯蒂芬吉林省大撒地方记录卡收到啥两地分居阿萨德</p>
        </div>
        <button class="pm_btn">我已经阅读</button>
    </div>

    <form name="" id="form_up">
        <div class="info  none">
            <!-- 头部 -->
            <header class="detail_header">
                <a href="#" onclick="back();"></a>
                <h3>参会信息</h1>
            </header>
            <!--  表单 -->
            <div class="per_form">
                <!-- title -->
                <div class="info-type">
                    <ul>
                        <li class="title-first">2018年中科博爱中科博爱</li>
                        <li class="title-second">
                            <span>价格：</span>
                            <span class="ts_price"></span>
                            <span>*</span>
                            <span class="ts_num">1</span>
                            <span class="ts_last">(包含两天的会议费、会刊)</span>
                        </li>
                    </ul>
                </div>
                <!-- 信息 -->
                <div class="info-item">
                    <div class="ii_input">
                        <label for="">姓名：</label>
                        <input type="text" name="username" placeholder="用户名">
                    </div>
                </div>
                <div class="info-item">
                    <div class="ii_input">
                        <label for="">联系方式：</label>
                        <input type="text" name="phone" placeholder="手机号">
                    </div>
                </div>
                <div class="info-item">
                    <div class="ii_input">
                        <label for="">邮箱：</label>
                        <input type="text" name="email" placeholder="邮箱">
                    </div>
                </div>
                <div class="info-item">
                    <div class="ii_input">
                        <label for="">单位：</label>
                        <input type="text" name="danwei" placeholder="工作单位">
                    </div>
                </div>
                <div class="info-item">
                    <div class="ii_input">
                        <label for="">职位：</label>
                        <input type="text" name="zhiwei" placeholder="">
                    </div>
                </div>

            </div>
            <!-- 备注 -->
            <div class="info-beizhu">
                <p>备注:</p>
                <textarea name="beizhu" id="" placeholder="填写备注"></textarea>
            </div>
            <!-- 支付方式 -->
            <div class="zhifu">
                <span>支付方式：</span>
                <input type="radio" name="zhifu" value="支付宝">
                <span>支付宝</span>
                <input type="radio" name="zhifu" value="微信">
                <span>微信</span>
            </div>
            <!-- 提交 -->
            <div class="info_btn clearfix">
                <div class="btn_price fl">
                    <span>￥</span>
                    <span class="price_sum">1000.00</span>
                </div>
                <div class="btn_btn fl">
                    立即付款
                </div>
            </div>
    </form>
    </div>



    <script src="../../plugin/seedsui.min.js"></script>
    <script src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
    <script src="../../plugin/icheck.min.js"></script>
    <script src="../../js/jquery.uiAlertView-1.0.0.js"></script>
    <script src="../../js/ajax.js"></script>
    <script>
        $(document).ready(function () {
            $('.zhifu input').iCheck({
                checkboxClass: 'icheckbox_square-red',
                radioClass: 'iradio_square-red',
                increaseArea: '20%',// optional
            });
        });
        // 点击参会须知隐藏
        $('.pm_btn').on('click', function () {
            $('.pay_mod').hide();
            $('.info').show();

        });
        function back() {
            history.go(-1);
        }
        /*
            页面跳转接受参数封装
        */
        function GetRequest() {
            var url = location.search, //获取url中"?"符后的字串
                theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURIComponent(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }

        var url_code = GetRequest(), // 输出 {table: aaa, “id": xxx}
            index_id = url_code['id'], // xxx
            index_table = url_code['table'];  //aaa

        //读取保存在localStorage对象里名为pay_type的变量的值
        var admin = localStorage.getItem("username"),
            pay_type = localStorage.getItem("pay_type"),
            pay_num = localStorage.getItem("pay_num");
        //  读取之后删除本地存储
        localStorage.removeItem("pay_type"); //undefined
        localStorage.removeItem("pay_num"); //undefined

        $('.ts_price').html(pay_type);
        $('.ts_num').html(pay_num);
        $('.price_sum').html(pay_type * pay_num);


        $('.btn_btn').on('click', function () {
            var form = document.getElementById("form_up");

            var fd = new FormData(form);
            console.log(fd);
            // 姓名校验
            var rename = /^([\u4e00-\u9fa5]){2,7}$/i;
            var  tel=/^[1][3,4,5,7,8][0-9]{9}$/i;
            var email = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/i;
            if (!rename.test(fd.get("username"))) {
                $.alertView("请输入正确的姓名");
            }  else if(!tel.test(fd.get("phone"))){
                $.alertView("请输入正确的手机号");
            }else if(!email.test(fd.get("email"))){
                $.alertView("邮箱不正确");
            }else if(!(fd.get("zhiwei")&&fd.get("danwei"))){
                $.alertView("请将单位或职位信息填写完整");
            }else if(!fd.get("zhifu")){
                $.alertView("请选择付款方式");
            }else {
                fd.append('table', index_table); //添加缴费属于那个标签
                fd.append('id', index_id); // id
                fd.append('admin', admin);   // 用户登录名
                $.ajax({
                    url: "http://39.104.90.182:80/px/service/px/pay_bm.json?userid=" + admin,
                    type: "POST",
                    data: fd,
                    dataType: 'json',
                    processData: false,  // 告诉jQuery不要去处理发送的数据
                    contentType: false,   // 告诉jQuery不要去设置Content-Type请求头
                    success: function (res) {
                        window.location.href = './pay.html'
                    }
                });
            }


        });


    </script>





</body>

</html>